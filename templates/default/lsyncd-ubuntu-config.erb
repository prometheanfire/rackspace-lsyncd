settings = {
   logfile     = "<%= node['rackspace-lsyncd']['log-file']%>",
   statusFile  = "<%= node['rackspace-lsyncd']['status-file']%>",
   inotifyMode = "CloseWrite or Modify",
   insist      = 1
}

<% unless@target_servers.empty? %>
<% @target_servers.each do |member| -%>

sync {
    default.rsync,
    source = "<%= node['rackspace-lsyncd']['source'] %>",
    target = "<%= node['rackspace-lsyncd']['target-user'] %><%= member[:ipaddress] %>:<%= node['rackspace-lsyncd']['target'] %>",
    rsyncOps = {
        <% node['rackspace-lsyncd']['rsync-options'].each do |option| %>
          "<%= option %>",
        <% end %>
    }
}
<% end %>
<% end %>